# This code was written by an AI assistant.

name: FTP-Deploy
on:
  push:
    branches:
      - nekoweb  # Set this to your default branch

jobs:
  ftp-deploy:
    name: Deploy via FTP
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        submodules: 'recursive'  # Fetch all submodule content, including nested submodules.

    - name: Install lftp
      run: sudo apt-get update && sudo apt-get install -y lftp

    - name: Deploy files with delay
      env:
        FTP_USERNAME: ${{ secrets.FTP_USERNAME }}
        FTP_PASSWORD: ${{ secrets.FTP_PASSWORD }}
      run: |
        echo "Starting FTP deployment with delay..."
        find . -type f | while read file; do
          echo "Uploading $file..."
          lftp -u "$FTP_USERNAME","$FTP_PASSWORD" -p 30000 ftp.nekoweb.org <<EOF
          set ftp:ssl-allow no
          set net:timeout 10
          set net:max-retries 2
          set net:reconnect-interval-base 5
          put -O / "$file"
          bye
          EOF
          sleep 4  # Add a 4-second delay between uploads
        done

# End of code written by an AI assistant.