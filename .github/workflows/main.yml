# This code was written by an AI assistant.

name: FTP-Deploy
on:
  push:
    branches:
      - nekoweb  # Set this to your default branch

jobs:
  ftp-deploy:
    name: Deploy via FTP
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        submodules: 'recursive'  # Fetch all submodule content, including nested submodules.

    - name: Install lftp
      run: sudo apt-get update && sudo apt-get install -y lftp

    - name: Deploy files via lftp
      env:
        FTP_USERNAME: ${{ secrets.FTP_USERNAME }}
        FTP_PASSWORD: ${{ secrets.FTP_PASSWORD }}
      run: |
        lftp -u "$FTP_USERNAME","$FTP_PASSWORD" -p 30000 ftp.nekoweb.org <<EOF
        set ftp:ssl-allow no
        set net:timeout 10
        set net:max-retries 2
        set net:reconnect-interval-base 5
        mirror --reverse --delete --verbose ./ / --parallel=1 --transfer-delay=2
        bye
        EOF

# End of code written by an AI assistant.